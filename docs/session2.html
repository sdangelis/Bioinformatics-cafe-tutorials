<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>session 2</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">[BETA] R tutorial</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">About</a>
</li>
<li>
  <a href="setup.html">setup</a>
</li>
<li>
  <a href="session1.html">session 1</a>
</li>
<li>
  <a href="packages.html">packages</a>
</li>
<li>
  <a href="session2.html">session 2</a>
</li>
<li>
  <a href="session3.html">session 3</a>
</li>
<li>
  <a href="reading.html">reading &amp; resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">session 2</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#custom-functions-and-control-flow">Custom functions and control flow</a>
<ul>
<li><a href="#control-flow">Control flow</a></li>
</ul></li>
<li><a href="#creating-custom-functions">Creating custom functions</a>
<ul>
<li><a href="#docstring">docstring</a></li>
</ul></li>
<li><a href="#loops">Loops</a>
<ul>
<li><a href="#for-loops">for loops</a></li>
<li><a href="#while">While</a></li>
<li><a href="#repeat">Repeat</a></li>
</ul></li>
<li><a href="#apply-functions">Apply functions</a>
<ul>
<li><a href="#anonymous-functions">Anonymous functions</a></li>
<li><a href="#a-note-on-performance-and-vectorisation">A note on performance and vectorisation</a></li>
</ul></li>
<li><a href="#into-the-tidyverse">Into the tidyverse</a>
<ul>
<li><a href="#manipulating-data-frames-effectively">manipulating data frames effectively</a></li>
<li><a href="#one-pipe-two-pipes">one pipe, two pipes</a></li>
<li><a href="#dyplr">dyplr</a></li>
<li><a href="#string-manipulation">string manipulation</a></li>
<li><a href="#ggplot2">ggplot2</a>
<ul>
<li><a href="#scatterplot">scatterplot</a></li>
<li><a href="#histogram">histogram</a></li>
<li><a href="#boxplot">boxplot</a></li>
<li><a href="#violin-plot">violin plot</a></li>
<li><a href="#dotplot">dotplot</a></li>
</ul></li>
<li><a href="#colour-palettes">colour palettes</a></li>
</ul></li>
</ul>
</div>

<p>Work in progress! please come back later. the outline here refers to the plan for session 2.</p>
<pre class="r"><code>library(tidyverse)
library(docstring)</code></pre>
<p>Welcome to day 2! Today we’ll introduce some powerful programming concepts and use tidy R to analyse the results of a cell biology experiment.</p>
<div id="custom-functions-and-control-flow" class="section level2">
<h2>Custom functions and control flow</h2>
<div id="control-flow" class="section level3">
<h3>Control flow</h3>
<p>Before we</p>
</div>
</div>
<div id="creating-custom-functions" class="section level1">
<h1>Creating custom functions</h1>
<p>So far, if we needed to</p>
<p>A powerful</p>
<p>note that w</p>
<p>R by default returns the last item evaluated. sometimes it si</p>
<div id="docstring" class="section level2">
<h2>docstring</h2>
<p>we could add a comment to the function to describe what the function does but this will not be actually associated with the function when we call it or appear if we use <code>?my_function</code></p>
<p>The package docstring allows us to generate documentation for any function on the fly, borrowing from</p>
<pre class="r"><code>sum3 &lt;- function(x, y){
  #&#39; Sums two numbers
  #&#39; 
  #&#39; @param x the first number to sum
  #&#39; @param y the second number to sum
  #&#39; @return the sum of \code{x} and \code{y
  #&#39; @example 
  #&#39; sum(2,2)
  x+y
} </code></pre>
<p>note <code>#'</code> is mandatory. We can use tags from <a href="https://roxygen2.r-lib.org/articles/rd.html">Roxygen2</a> to structure our documentation. There are lots of tags, some useful ones are</p>
<ul>
<li><span class="citation">@param</span> argument description` to specify the description of arguments</li>
<li><span class="citation">@return</span> to specify what the function returns</li>
<li><span class="citation">@examples</span> r code that provides an example for how to use a function. this will run so it has to be either valid R code or wrapped in a <code>\dontrun{code}</code> block</li>
<li><span class="citation">@note</span> to add a note</li>
<li><span class="citation">@references</span> to add a citation to your function</li>
</ul>
</div>
</div>
<div id="loops" class="section level1">
<h1>Loops</h1>
<p>there are 3 types of loops in R: for while and repeat. Most of the time we can use while or for loops but</p>
<div id="for-loops" class="section level2">
<h2>for loops</h2>
<p>for loops repeat the expression n times. we can access tjh</p>
<pre class="r"><code>for(i in 1:10){
  print(i)
}</code></pre>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
<p>Conventionally the counter for loops is <code>i</code>, in case of nested loops <code>i</code> is taken for the first loop so we can use <code>j</code> in the second loop and so on.</p>
</div>
<div id="while" class="section level2">
<h2>While</h2>
<p>While loops repeat a code block until a certain condition is met, for instance we can count to 10 by printing. Note when working in a while loop we need to manually increment the counter and make sure the exit condition makes sense, else our loop will run literally forever</p>
<pre class="r"><code>count=1
while (count&lt;11){
  print(count)
  count = count+1 
}</code></pre>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
</div>
<div id="repeat" class="section level2">
<h2>Repeat</h2>
<p>Repeat loops are similar to while loops but execute once then use a break statement to exit the loop once we met our condition.</p>
<pre class="r"><code>x=0
repeat {
  print(x)
  x = x+1
  if (x == 11){
    break
  }}</code></pre>
<pre><code>## [1] 0
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
<p>the <code>break</code> statement to quit a loop early work in all kinds of loops similarly <code>next</code> skips the current iteration</p>
</div>
</div>
<div id="apply-functions" class="section level1">
<h1>Apply functions</h1>
<p>A generally preferred alternative to loops. Despite common belief this is not necessarily faster than a loop<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div id="anonymous-functions" class="section level2">
<h2>Anonymous functions</h2>
<p>The apply family of functions becomes very powerful when coupled with anonymous functions. Anonymous functions are functions that have no name we can create an anonymous function with <code>funtion(x) { function body }</code></p>
<p>The purr package additionally provides some more</p>
</div>
<div id="a-note-on-performance-and-vectorisation" class="section level2">
<h2>A note on performance and vectorisation</h2>
<p>As you might have noticed our loop to multiply a vector by a number is much slower than using <code>*</code>. R is a vectorised which means operations on a whole vector are much faster than the sum of each individual operations on each element.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Nonetheless, loops are quick (but not fast), dirty and can get the job done. there are some tricks to make sure loops run as fast as they can 1. Never grow a variable inside a loop</p>
<p>it is tempting to write a loop where we grow a variable by 1 in each iteration. For instance in this loop we sample from a normal distribution n times and return all the variables. Note the <code>rnorm()</code> function here is just an example of something that runs at each iteration, if we want to sample n elements from a normal distribution we can and should use <code>rmorm(n)</code></p>
<pre class="r"><code>bad_loop &lt;- function (n){
  x = NA
  for(i in 1:n){
    x &lt;- c(x, rnorm(1)) 
  }
  return(x)
}</code></pre>
<p>however, every time we grow the variable we force R to copy the vector to a new memory location with more space, consuming time</p>
<p>Our loop will be much faster if we create a vector of the right size first and then replace values as we go along.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<pre class="r"><code>good_loop &lt;- function(n){
  x &lt;- rep(NA,n)
  for(i in 1:n){
    x[i] &lt;- rnorm(1) 
  }
  return(x)
}</code></pre>
<p>We can use the <code>system.time()</code> function to quickly check how fast is our code.</p>
<pre class="r"><code>system.time(good_loop(1e5))</code></pre>
<pre><code>##    user  system elapsed 
##    0.17    0.00    0.17</code></pre>
<pre class="r"><code>system.time(bad_loop(1e5))</code></pre>
<pre><code>##    user  system elapsed 
##   15.09    0.14   15.23</code></pre>
<p>Compared to the more optimised loop, the bad loop is unreasonably slow. The Rstudio Built in profiler reveals that the bad loop spends most of the time in the <code>c()</code> rather than <code>rmorm()</code></p>
<ol start="2" style="list-style-type: decimal">
<li>keep an eye on assignments</li>
</ol>
<p>The sharper eyes noted that the bad loop first creates a new vector with the old array and new value, then grows the old array. We can remove this extra step. In general keep an eye on unnecessary assignments in loops as they can be costly.</p>
<pre class="r"><code>less_bad_loop &lt;- function (n){
  x = NA
  for(i in 1:n){
    x[i] &lt;- rnorm(1) 
  }
  return(x)
}</code></pre>
<p>We can now compare the two loops again.</p>
<pre class="r"><code>system.time(good_loop(1e5))</code></pre>
<pre><code>##    user  system elapsed 
##    0.16    0.00    0.16</code></pre>
<pre class="r"><code>system.time(less_bad_loop(1e5))</code></pre>
<pre><code>##    user  system elapsed 
##    0.19    0.00    0.18</code></pre>
<p>Now the difference is much smaller but still noticeable. For more performance tricks, see the [R Inferno book]</p>
</div>
</div>
<div id="into-the-tidyverse" class="section level1">
<h1>Into the tidyverse</h1>
<p>By now we have all the tools we need to use R effectively</p>
<div id="manipulating-data-frames-effectively" class="section level2">
<h2>manipulating data frames effectively</h2>
</div>
<div id="one-pipe-two-pipes" class="section level2">
<h2>one pipe, two pipes</h2>
<p>pipes reside in the magrittr package but are implicitly imported by tidy packages a pipe connects the output from a function to another, without the need to assign it to a variable</p>
<p>if you are on R &gt;= 4.1 pipes are now part of base r <code>|&gt;</code> will get you a pipe. it works like <code>%&gt;%</code> but has no support for the <code>.</code> placeholder</p>
</div>
<div id="dyplr" class="section level2">
<h2>dyplr</h2>
</div>
<div id="string-manipulation" class="section level2">
<h2>string manipulation</h2>
</div>
<div id="ggplot2" class="section level2">
<h2>ggplot2</h2>
<div id="scatterplot" class="section level3">
<h3>scatterplot</h3>
</div>
<div id="histogram" class="section level3">
<h3>histogram</h3>
</div>
<div id="boxplot" class="section level3">
<h3>boxplot</h3>
</div>
<div id="violin-plot" class="section level3">
<h3>violin plot</h3>
</div>
<div id="dotplot" class="section level3">
<h3>dotplot</h3>
</div>
</div>
<div id="colour-palettes" class="section level2">
<h2>colour palettes</h2>
<p>While the ggplot default palette is somewhat iconic, colours from the viridis package are a good starting point to choose colours. They are designed accessible to people with colourblindness, legible in grayscale and be perceptually uniform so each colour has a uniform distance from the next colour.</p>
<p>for base plots we need to separately generate a viridis colour palette.</p>
<p>in ggplot2 based graphics we can use the <code>scale_fill_viridis()</code> and <code>scale_color_viridis()</code> in our plot as needed.</p>
<p>But if we feel more artsy, we can pick colour palettes from everything, from <a href="https://github.com/karthik/wesanderson">Wes Anderson movies</a> to <a href="https://github.com/ewenme/ghibli">Stuido Ghibli Films</a>. For a comprehensive list see the <a href="https://github.com/EmilHvitfeldt/r-color-palettes">paletteer</a> package.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>see Advanced R and the R inferno<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>This is not black magic, vectorised functions loop over items in C rather than R. C has less overhead so is faster.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>note depending on what kind of object x is, using x[i] might still duplicate it<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
