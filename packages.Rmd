---
title: "R packages and how to use them"
---

So far we've only used functions supplied as part of base R. However the real power of R comes from the ability to import functions
the community of R programmers has built. These come in packages, which are a series of related functions bundled together

generally speaking before implementing your function it is always worth checking if there is a well-maintained and documented package that performs what you would like to do. 

## Installing packages

Most R packages belong to a repository known as CRAN. CRAN packages can be installed with a function 
```{r, eval=F}
install.packages("package_name")
```

Often R will ask for your permission to install packages from source rather than precompiled binaries. If you want to use the most recent version in CRAN say yes, if you want to skip a potentially time consuming step say no. Installing packages from source on Windows PCs requires an additional component [RTools](https://cran.r-project.org/bin/windows/Rtools/) 

But wait what does compiling mean? Unlike R and python where source code can be run directly, some programming languages
need to be converted into human-unreadable machine code that is somewhat specific to a system before any code can be run. 
This step is known as compilation. In short this allows for optimisation of the resulting machine code at the cost of flexibility, as things like what type variables are can be decided in advance. 
R packages often interface with compiled code to speed up computation

### Packages for session 2 

before the next session try to install the following packages 
- tidyverse
- cowplot
- 
-

```{r, eval = FALSE, }
# you can use c() to create a vector of all the pacakges 
install.packages(c("tidyverse"))
```

## Using packages 

packages can be loaded by using the library function.
Conventionally, packages are loaded at the beginning of a script, 
to make clear which packages the script needs to run

```{r warning=TRUE}
library(cowplot)
```

once loaded you can use the functions in the package as normal

Often it is useful to record which packages are loaded alongside their version, in this case we can use sessionInfo() to display information on R and the installed packages. 
```{r}
sessionInfo()
```

In the rare event you'd need to unload a package you can use 
`detach("package:name", unload = TRUE)`. Be careful with this, it is often preferable to restart R form scratch.
for instance we can now remove cowplot from the environment, and see it disappear from the session information  
```{r}
detach("package:cowplot", unload = TRUE)
sessionInfo()
```

### citing packages

Citing the packages used in your work is important, both for reproducibility and to acknowledge the work done by the package authors. You should always make an effort to cite the packages used in your analysis.
We can use the `citation("package")` function to retrieve the citation information

for instance the IRanges package suggests you cite a PLOS Computational Biology
```{r}
citation("IRanges")
```
Of course, packages are often built on top of other packages, under most conditions it would not be reasonable to cite all the packages used and all their dependencies.

# key packages

This section will introduce some key packages for the analysis of biological data.

## Tidyverse

the tidyverse is a family of packages designed by the people behind RStudio.
they can be installed and loaded as one tidyverse
They share a similar philosophy and can be very powerful for data manipulation.
However, it is important to note that the way of doing things in tidy R is often quite
different from how you would operate in base R.

The tidyverse packages provide methods to clean messy data and manipulate data with base idea that 
tidy data is easy to manipulate. tidy data is defined as data where 
 
1. Every column is a variable.
2. Every row is an observation.
3. Every cell is a single value.

you can read more about tidy data [here](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)

## ggplot2 

ggplot2 is a plotting package. while base R plots can become very beautiful with lots of customisation,
ggplot2 can easily produces publication quality graphics with comparatively little effort

GGplot is based on the grammar of graphics, a whole theory of how to describe a plot whose explanation is 
best left to the (official book)[https://ggplot2-book.org/index.html]. in short a ggplot2 graph is composed
of 3 main elements: data, a geometry representing the individual data points and a mapping

for a gallery of what is possible with ggplot and other plotting packages see 
[r graph gallery ](https://www.r-graph-gallery.com/histogram)
ggplot2's grammar can appear complex at first, so we'll cover some common plots in session 2.

## Bioconductor 

bioconductor is a repository of bioinformatics packages, which are not accessible from CRAN
We can install bioconductor following [their instructions](http://bioconductor.org/install/). we can see here another example of the `namespace::function` syntax
```{r, eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install()
```

This will install a set of core packages, additional packages (i.e AneuFinder) can be installed 
by specifying their name.
```{r, eval=FALSE}
BiocManager::install("AneuFinder")
```

## namespaces 

Functions are conventionally named with a short, descriptive verb. However sometimes two packages use the same name for a function. In this case the most recently loaded package will overwrite the previous one

A very common case is the filter function in the dyplr package which overrides the default R function. Despite the shared name they do very different things

(base R) apply a linear filter to a timeseries 
```{r}
x <- 1:100
filter(x, rep(1, 3))
```
once we load tidyr we see the function no longer works 
```{r, error = TRUE}
library(tidyr)
filter(x, rep(1, 3))
```

R has a very elegant built-in way to select which package, or namespace, we want to get our function from 
`namespace::function`

we can restore the default behavior by explicitly asking for the filter function contained in the stats namespace, one of the R base packages that are loaded
```{r}
stats::filter(x, rep(1, 3))
```

Arguably, it can be worth to use the :: operator everytime you use a function from a package to explicitly state what packages are required
This is suggested by the [Google R Style Guide](https://google.github.io/styleguide/Rguide.html)

## R markdown 

Compared to a script, which contains only your code and plain text comments, 
R markdown can be a very powerful way to present your R code, its output and comments in markdown formatted text which can be shared in a wide range of formats including pdfs, office docs, presentations.  

The base idea is that there are code chunks, which get exectuded with the output printed below and formatted text. 
To illustrate the power of r markdown this website is automatically generated by a series of R notebooks, available on [github](https://github.com/sdangelis/Bioinformatics-cafe-tutorials).

You can here more about R Markdown with this [book](https://bookdown.org/yihui/rmarkdown/)


